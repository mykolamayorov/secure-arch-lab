# –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏–π –∑–≤—ñ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ1: –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Ç–∏–ø—ñ–∑–∞—Ü—ñ—ó —Ç–∞ response_model —É FastAPI

**–§–∞–π–ª:** main.py

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**  
–£ —Ñ—É–Ω–∫—Ü—ñ—ó `get_user` –Ω–µ–º–∞—î —Ç–∏–ø—ñ–∑–∞—Ü—ñ—ó –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ —Ç–∞ `response_model`.  
–£ —Ñ—É–Ω–∫—Ü—ñ—ó `login` –≤—ñ–¥—Å—É—Ç–Ω—è —Å—Ö–µ–º–∞ –¥–ª—è request. –¶–µ —É–Ω–µ–º–æ–∂–ª–∏–≤–ª—é—î –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –≤—Ö—ñ–¥–Ω–∏—Ö —ñ –≤–∏—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Semgrep, SAST –∞–±–æ DAST. –ë–µ–∑ —Å–∏–≥–Ω–∞–ª—É –¥–ª—è –≥–µ–π—Ç—ñ–≤ –∫–æ–¥ ¬´–º–æ–≤—á–∏—Ç—å¬ª –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó.

**–†–æ–∑–¥—ñ–ª/–ø–∞—Ç–µ—Ä–Ω –∫–æ–Ω—Å–ø–µ–∫—Ç—É:**

- OpenAPI + —Ç–∏–ø—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö (Pydantic)
- –ö–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞, —Å–∏–≥–Ω–∞–ª –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ DAST/SAST

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**

- –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `pydantic.BaseModel` –¥–ª—è –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö —ñ `response_model` —É FastAPI.
- –ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ OpenAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑ —Ç–∏–ø—ñ–≤.

# ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–æ–¥: main.py (—Ç–∏–ø—ñ–∑–∞—Ü—ñ—è —Ç–∞ response_model)

@app.get("/user", response_model=UserResponse)
def get_user(id: int):
return {"id": id, "name": "Alice"}

---

### –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ2: –°–µ–∫—Ä–µ—Ç–∏ —á–µ—Ä–µ–∑ envFrom –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—é CSI

**–§–∞–π–ª:** deployment.yaml

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**  
–°–µ–∫—Ä–µ—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ `envFrom.secretRef` –±–µ–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Vault CSI. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ —Å–µ–∫—Ä–µ—Ç–∏ –º–æ–∂—É—Ç—å –∑–±–µ—Ä—ñ–≥–∞—Ç–∏—Å—è —É plaintext —É CI/CD –∞–±–æ —Ö–æ—Å—Ç—ñ. –ì–µ–π—Ç–∏ OPA –∞–±–æ policy-as-code –Ω–µ –º–∞—é—Ç—å —Å–∏–≥–Ω–∞–ª—É –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —â–æ —Å–µ–∫—Ä–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—é—î—Ç—å—Å—è.

**–†–æ–∑–¥—ñ–ª/–ø–∞—Ç–µ—Ä–Ω –∫–æ–Ω—Å–ø–µ–∫—Ç—É:**

- Vault CSI –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤
- PoLP —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω—ñ—Å—Ç—å –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**

- –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ Vault CSI driver –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤ —á–µ—Ä–µ–∑ volume.
- –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ `env.value` —á–µ—Ä–µ–∑ OPA / conftest.

# ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–æ–¥: deployment.yaml (Vault CSI)

volumes:

- name: secrets
  csi:
  driver: vault.csi.hashicorp.com
  readOnly: true
  volumeAttributes:
  secretProviderClass: "user-api-secrets"

volumeMounts:

- name: secrets
  mountPath: /mnt/secrets
  readOnly: true

---

### –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ3: –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —ñ–∑–æ–ª—è—Ü—ñ—ó –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**–§–∞–π–ª:** deployment.yaml

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**  
–í—ñ–¥—Å—É—Ç–Ω—ñ–π `securityContext` (`readOnlyRootFilesystem`, `runAsNonRoot`) —ñ –Ω–µ–º–∞—î –æ–±–º–µ–∂–µ–Ω–Ω—è `hostPath`. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–∞—á–∏—Ç—å —Ö–æ—Å—Ç–æ–≤–∏–π FS —ñ –º–æ–∂–µ –µ—Å–∫–∞–ª—é–≤–∞—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó. –ì–µ–π—Ç–∏ –Ω–µ –æ—Ç—Ä–∏–º—É—é—Ç—å —Å–∏–≥–Ω–∞–ª—É –ø—Ä–æ –ø–æ—Ä—É—à–µ–Ω–Ω—è —ñ–∑–æ–ª—è—Ü—ñ—ó.

**–†–æ–∑–¥—ñ–ª/–ø–∞—Ç–µ—Ä–Ω –∫–æ–Ω—Å–ø–µ–∫—Ç—É:**

- –Ü–∑–æ–ª—è—Ü—ñ—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ (—Ñ–∞–π–ª–æ–≤–∞, –º–µ—Ä–µ–∂–Ω–∞, build-time)
- PoLP / ¬´–Ω–µ–≤–∏–¥–∏–º—ñ—Å—Ç—å¬ª

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**

- –î–æ–¥–∞—Ç–∏ `securityContext: readOnlyRootFilesystem: true, runAsNonRoot: true`.
- –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ `hostPath` —á–µ—Ä–µ–∑ OPA / conftest.

# ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–æ–¥: deployment.yaml (securityContext)

containers:

- name: user-api
  image: user-api:latest
  securityContext:
  runAsNonRoot: true
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false

---

### –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ4: CI/CD –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ –±–µ–∑–ø–µ–∫–∏

**–§–∞–π–ª:** ci.yml

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**  
–ü–∞–π–ø–ª–∞–π–Ω –ª–∏—à–µ –±—É–¥—É—î Docker-–æ–±—Ä–∞–∑. –í—ñ–¥—Å—É—Ç–Ω—ñ Semgrep, Trivy, Gitleaks, SBOM, –ø—ñ–¥–ø–∏—Å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –ø–æ—Ä—É—à–µ–Ω–Ω—è —Ç–∏–ø—ñ–≤, —Å–µ–∫—Ä–µ—Ç—ñ–≤ –∞–±–æ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π —É –æ–±—Ä–∞–∑—ñ –Ω–µ –±—É–¥—É—Ç—å –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ.

**–†–æ–∑–¥—ñ–ª/–ø–∞—Ç–µ—Ä–Ω –∫–æ–Ω—Å–ø–µ–∫—Ç—É:**

- –ì–µ–π—Ç–∏ —É CI/CD
- –°–∏–≥–Ω–∞–ª–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ / Policy-as-Code

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**

- –î–æ–¥–∞—Ç–∏ –∫—Ä–æ–∫–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–æ–¥—É (Semgrep), –æ–±—Ä–∞–∑—ñ–≤ (Trivy), —Å–µ–∫—Ä–µ—Ç—ñ–≤ (Gitleaks).
- –ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ SBOM (syft) —Ç–∞ –ø—ñ–¥–ø–∏—Å—É–≤–∞—Ç–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ (cosign).

# ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–æ–¥: ci.yml (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∞ SBOM)

- name: Run Semgrep
  uses: returntocorp/semgrep-action@v2
  with:
  config: p/ci

- name: Scan image with Trivy
  run: trivy image user-api:latest

- name: Generate SBOM
  run: syft user-api:latest -o json > sbom.json

- name: Sign image
  run: cosign sign user-api:latest

---

### –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ5: –ù–∞–¥–º—ñ—Ä–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó –≤ Terraform

**–§–∞–π–ª:** main.tf

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**  
Security Group –¥–æ–∑–≤–æ–ª—è—î –≤–µ—Å—å —Ç—Ä–∞—Ñ—ñ–∫ –Ω–∞ –ø–æ—Ä—Ç 443 (`cidr_blocks: 0.0.0.0/0`). –¶–µ –ø–æ—Ä—É—à—É—î –ø—Ä–∏–Ω—Ü–∏–ø PoLP —ñ –º–µ—Ä–µ–∂–µ–≤—É —ñ–∑–æ–ª—è—Ü—ñ—é. –ë–µ–∑ —Å–∏–≥–Ω–∞–ª—ñ–≤ –¥–ª—è tfsec / OPA –∑–º—ñ–Ω–∏ –Ω–µ –ø–æ–º—ñ—Ç–Ω—ñ.

**–†–æ–∑–¥—ñ–ª/–ø–∞—Ç–µ—Ä–Ω –∫–æ–Ω—Å–ø–µ–∫—Ç—É:**

- –ü—Ä–∏–Ω—Ü–∏–ø –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ (PoLP)
- –Ü–∑–æ–ª—è—Ü—ñ—è –º–µ—Ä–µ–∂—ñ

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**

- –û–±–º–µ–∂–∏—Ç–∏ CIDR —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∏–º–∏ –ø—ñ–¥–º–µ—Ä–µ–∂–∞–º–∏ –∞–±–æ VPN.
- –î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É tfsec –∞–±–æ OPA-–ø–æ–ª—ñ—Ç–∏–∫—É –¥–ª—è SG.

# ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–æ–¥: main.tf (–æ–±–º–µ–∂–µ–Ω–Ω—è CIDR)

ingress {
from_port = 443
to_port = 443
protocol = "tcp"
cidr_blocks = ["10.0.1.0/24"]
}

---

### –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ6: Docker-–æ–±—Ä–∞–∑ –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—é –≤–µ—Ä—Å—ñ–π —Ç–∞ –ø—ñ–¥–ø–∏—Å—É

**–§–∞–π–ª:** Dockerfile

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**  
–û–±—Ä–∞–∑ –Ω–µ –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π —ñ –Ω–µ –º—ñ—Å—Ç–∏—Ç—å SBOM. –ë—É–¥—å-—Ö—Ç–æ –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ –±–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑, –¥–æ–¥–∞—Ç–∏ —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –∞–±–æ —Å–µ–∫—Ä–µ—Ç–∏ –±–µ–∑ —Å–∏–≥–Ω–∞–ª—ñ–≤.

**–†–æ–∑–¥—ñ–ª/–ø–∞—Ç–µ—Ä–Ω –∫–æ–Ω—Å–ø–µ–∫—Ç—É:**

- Supply chain –∫–æ–Ω—Ç—Ä–æ–ª—å (SBOM, cosign)

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**

- –î–æ–¥–∞—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é SBOM (`syft`) —É CI.
- –ü—ñ–¥–ø–∏—Å—É–≤–∞—Ç–∏ –æ–±—Ä–∞–∑ —á–µ—Ä–µ–∑ cosign.

# ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–æ–¥: Dockerfile (–¥–æ–¥–∞–Ω–æ SBOM)

RUN pip install syft && syft /app -o json > /app/sbom.json

---

## üí° –í–∏—Å–Ω–æ–≤–æ–∫

–®–∞–±–ª–æ–Ω user-api –º–∞—î –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ—Ä—É—à–µ–Ω–Ω—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏: –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Ç–∏–ø—ñ–∑–∞—Ü—ñ—ó, –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤, —ñ–∑–æ–ª—è—Ü—ñ—ó –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ CI/CD —Ç–∞ PoLP —É –º–µ—Ä–µ–∂–µ–≤–æ–º—É –¥–æ—Å—Ç—É–ø—ñ.  
–í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –ø–∞—Ç–µ—Ä–Ω—ñ–≤ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ (Vault CSI, OpenAPI + Pydantic, OPA, SBOM, securityContext) —Ç–∞ –≥–µ–π—Ç—ñ–≤ —É CI/CD –∑–∞–±–µ–∑–ø–µ—á–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω—ñ—Å—Ç—å, —Å–∏–≥–Ω–∞–ª—ñ–∑–∞—Ü—ñ—é —Ç–∞ –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ–π.
